#!/bin/sh
# Auteur :      prx <prx@ybad.name>
# licence :     MIT

# Description : configure xenodm
# Depends : dmenu

defaultbg=/usr/local/share/isotop/walls/loginbg.jpg

title="Xenodm configuration"
question="What do you wan't to configure?"
txt_chgbg="Choose background image"
txt_rdbmg="Choose random background image directory"
txt_disableautologin="Disable autologin"
txt_autologin="Set up autologin. Warning, this leaves your machine open to the world"


case $LANG in
	fr*)
		title="Configuration de Xenodm"
		question="Que souhaitez-vous configurer ?"
		txt_chgbg="Choisir l'image d'arrière-plan"
		txt_rdbmg="Choisir un répertoire contenant les arrières-plans choisis au hasard"
		txt_disableautologin="Désactiver la connexion automatique"
		txt_autologin="Activer la connexion automatique. Attention, cela laisse votre ordinateur ouvert pour tous."
        ;;
esac

test -s $HOME/.dmenurc && . $HOME/.dmenurc

res=$(echo "$txt_chgbg
$txt_rdbmg
$txt_autologin
$txt_disableautologin" |\
	dmenu -l ${l} \
	-fn "${fn}" \
	-nb "${nb}" \
	-nf "${nf}" \
	-sb "${sb}" \
	-sf "${sf}" \
	-p "$question") 

case "$res" in
	"$txt_chgbg") 
		bg=$(find $HOME -type f -iname "*.jpg" |\
			dmenu -l ${l} \
			-fn "${fn}" \
			-nb "${nb}" \
			-nf "${nf}" \
			-sb "${sb}" \
			-sf "${sf}" \
			-p "image ?") 
		if [ -f "$bg" ]; then
			cp "$bg" "$defaultbg"
		fi
		;;
	"$txt_rdbmg") 
		bgdir=$(echo "" |\
			dmenu -l ${l} \
			-fn "${fn}" \
			-nb "${nb}" \
			-nf "${nf}" \
			-sb "${sb}" \
			-sf "${sf}" \
			-p "path ?") 
		if [ -d "$bgdir" ]; then
			sed -i "s;WALLDIR=.*$;WALLDIR=$bgdir;" /etc/X11/xenodm/Xsetup_0
		fi
		;;
	"$txt_autologin") 
		sed -i "s/DisplayManager._0.autoLogin:.*$//" /etc/X11/xenodm/xenodm-config
		echo "DisplayManager._0.autoLogin:    $USER" >> /etc/X11/xenodm/xenodm-config
		;;
	"$txt_disableautologin") 
		sed -i "s/DisplayManager._0.autoLogin:.*$//" /etc/X11/xenodm/xenodm-config
		;;
esac

exit 0

