#!/bin/sh
# choose how to modify an image
# requires zeniTK and GraphicsMagick 

OLDIFS=$IFS
IFS='
'

# trads
scaletitle="Scale image"
scaletext="What do you want to do ?"
scalemsg="Size to scale to <length>x<height>"
TOJPG="Convert to JPG"
TOPNG="Convert to PNG"
TOGIF="Convert to GIF"
RESIZE="Resize"
TURNR="Turn right"
TURNL="Turn left"

case $LANG in
	fr*)
		scaletitle="Redimensionner une image"
        scaletext="Que voulez-vous faire ?"
		scalemsg="Taille de redimensionnement <largeur>x<hauteur>"
        TOJPG="Convertir en JPG"
        TOPNG="Convertir en PNG"
        TOGIF="Convertir en GIF"
        RESIZE="Redimensionner l'image"
        TURNR="Tourner à droite"
        TURNL="Tourner à gauche"
        ;;
    de*)
		scaletitle="Stufenbild"
        scaletext="Was möchten Sie tun ?"
		scalemsg="Neue Größe <länge>x<höhe>"
        TOJPG="Konvertieren JPG"
        TOPNG="Konvertieren PNG"
        TOGIF="Konvertieren GIF"
        RESIZE="Größe ändern bild"
        TURNR="Nach rechts drehen"
        TURNL="Nach links drehen"
        ;;
    es*)
        scaletitle="image Escala"
        scaletext="Qué quieres hacer ?"
        scalemsg="Tamaño de escalar a <longitud> x <altura>"
        TOJPG="Convertir a JPG"
        TOPNG="Convertir a PNG"
        TOGIF="Convertir a GIF"
        RESIZE="Redimensionar"
        TURNR="Gire a la derecha"
        TURNL="Gire a la izquierda"
        ;;
esac

if [ $# -eq 0 ]; then
	echo "Nothing to do"
	exit
fi

R=$(zeniTK --text "$scaletext" --list \
    "$TOJPG" \
    "$TOPNG" \
    "$TOGIF" \
    "$RESIZE" \
    "$TURNR" \
    "$TURNL")

case $R in 
    $TOJPG ) 
        for i in $@; do
            gm convert -interlace line "$i" "${i%.*}.jpg"
        done
        ;;
    $TOPNG ) 
        for i in $@; do
            gm convert -interlace line "$i" "${i%.*}.png"
        done
        ;;
    $TOGIF ) 
        for i in $@; do
            gm convert -interlace line "$i" "${i%.*}.gif"
        done
        ;;
    $RESIZE ) 
        imgsize=$(zeniTK --title "$scaletitle" --entry --entry-text="100x100" --text="$scalemsg")
        for i in $@; do
            if [ -n "$imgsize" ]; then
                gm convert -scale $imgsize "$i" "${i%.*}-$imgsize.${i##*.}" 
            fi
        done
        ;;
    $TURNR ) 
        for i in $@; do
            gm convert -rotate 90 $i $i
        done
        ;;
    $TURNL ) 
        for i in $@; do
            gm convert -rotate -90 $i $i
        done
        ;;
esac
    
IFS=$OLDIFS
exit 0
