#!/usr/local/bin/python3
# -*- coding:Utf-8 -*- 
# Fichier: mpdplay.py
# Cree le 03 f√©vr. 2012 19:00:13


"""

Auteur :      thuban (thuban@yeuxdelibad.net)  
licence :     GNU General Public Licence
require : mpc

Description :
    Play any music in mpd
"""

import os
import sys

# Some options
playlistdir = os.path.expanduser('~/.mpd/playlists/')
if not os.path.isdir(playlistdir):
    os.mkdir(playlistdir)
mpdlist = 'mpdlist'
playlist = os.path.join(playlistdir,'{0}.m3u'.format(mpdlist))

def help():
    print('usage: {0} music1.mp3 music2.ogg folder/'.format(sys.argv[0]))
    print('add -n option to don\'t play the music just added')
    sys.exit(0)


def addFile(lof):
    l = []
    for fileOrDir in lof:
        if os.path.isdir(fileOrDir):
            for root, subFolders, files in os.walk(fileOrDir):
                for f in files:
                    l.append('{0}'.format(os.path.abspath(os.path.join(root,f))))
        elif os.path.isfile(fileOrDir):
            l.append(os.path.abspath(fileOrDir))
    return(l)

def main():
    play = True    # play the music or not
    if len(sys.argv) <= 1:
        help()
    else:
        if sys.argv[1] == '-n':
            play = False
            files = sys.argv[2:]
        else:
            files = sys.argv[1:]

    toLoad = addFile(files)
    # now, we know what music to load
    # creating the playlist
    with open(playlist, 'w') as plist:
        plist.write('#EXTM3U\n')
        for filepath in toLoad:
            print('to play : ',filepath)
            plist.write('{0}\n'.format(filepath))

    if play:
        num = len(os.popen('mpc playlist', 'r').readlines())
        print('num:',num)
        os.system('mpc load {0}'.format(mpdlist))
        os.system('mpc play {0}'.format(num + 1))
    else:
        os.system('mpc load {0}'.format(mpdlist))

    return 0

if __name__ == '__main__':
	main()

# vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4

